(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{436:function(t,a,s){"use strict";s.r(a);var e=s(2),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1整体结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1整体结构"}},[t._v("#")]),t._v(" 1整体结构")]),t._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CZhuChengHao%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221109150120985.png",alt:"image-20221109150120985"}})]),t._v(" "),a("h2",{attrs:{id:"_2http服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2http服务器"}},[t._v("#")]),t._v(" 2http服务器")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("http{\n  include       mime.types;\n  default_type  application/octet-stream;\n  #charset  gb2312;\n  sendfile        on;\n  keepalive_timeout  60s;\n}\n")])])]),a("ul",[a("li",[t._v("include是个主模块指令，实现对配置文件所包含的文件的设定，可以减少主配置文件的复杂度。该文件也在conf目录中。")]),t._v(" "),a("li",[t._v("default_type属于HTTP核心模块指令，这里设定默认类型为二进制流，也就是当文件类型未定义时使用这种方式。")]),t._v(" "),a("li",[t._v("charset gb2312; 指定客户端编码格式。")]),t._v(" "),a("li",[t._v("sendfile实际上是 Linux2.0+以后的推出的一个系统调用，web服务器可以通过调整自身的配置来决定是否利用 sendfile这个系统调用。sendfile是个比 read 和 write 更高性能的系统接口。 当 Nginx 是一个静态文件服务器的时候，开启 SENDFILE 配置项能大大提高 Nginx 的性能。 但是当 Nginx 是作为一个反向代理来使用的时候，SENDFILE 则没什么用。")]),t._v(" "),a("li",[t._v("Nginx 使用 keepalive_timeout 来指定 KeepAlive 的超时时间（timeout）。指定每个 TCP 连接最多可以保持多长时间。Nginx 的默认值是 75 秒，有些浏览器最多只保持 60 秒，所以可以设定为 60 秒。若将它设置为 0，就禁止了 keepalive 连接。")])]),t._v(" "),a("h2",{attrs:{id:"_3部署前后端分离项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3部署前后端分离项目"}},[t._v("#")]),t._v(" 3部署前后端分离项目")]),t._v(" "),a("h3",{attrs:{id:"_3-0常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0常用命令"}},[t._v("#")]),t._v(" 3.0常用命令")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd /data/nginx/sbin\n启动nginx\n./nginx\n关闭nginx\n./nginx -s stop\n./nginx -s quit\n检查\n./nginx -t\n重新加载配置\n./nginx -s reload\n")])])]),a("h3",{attrs:{id:"_3-1搭建后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1搭建后端"}},[t._v("#")]),t._v(" 3.1搭建后端")]),t._v(" "),a("h3",{attrs:{id:"_3-2搭建前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2搭建前端"}},[t._v("#")]),t._v(" 3.2搭建前端")]),t._v(" "),a("p",[t._v("router修改为html5模式")]),t._v(" "),a("p",[t._v("history: createWebHistory(),")]),t._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CZhuChengHao%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221109160119159.png",alt:"image-20221109160119159"}})]),t._v(" "),a("p",[t._v("打包")]),t._v(" "),a("p",[t._v("npm run build")]),t._v(" "),a("p",[t._v("在dist目录下 把东西放到nginx中")]),t._v(" "),a("h3",{attrs:{id:"_3-3nginx做静态服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3nginx做静态服务器"}},[t._v("#")]),t._v(" 3.3nginx做静态服务器")]),t._v(" "),a("p",[t._v("可以把前端资源放到 任意地方")]),t._v(" "),a("p",[t._v("在linux中 创建一个目录 /data/www 作为主目录")]),t._v(" "),a("p",[t._v("其中放前端静态资源")]),t._v(" "),a("p",[t._v("我们在nginx.conf中进行配置")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server{\n    listen 80 default; //端口\n    server_name www.ydlclass.com; //ip\n    index index.html; //主页\n    root /data/www;  //根目录\n}\n")])])]),a("h3",{attrs:{id:"_3-4虚拟主机配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4虚拟主机配置"}},[t._v("#")]),t._v(" 3.4虚拟主机配置！！！！！")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v(" www.ydlclass.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" index.html index.htm index.php")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" //主页\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" /data/www")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  //根目录\n       \n        \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ^~ /backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v("   /data/www/backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配"}},[t._v("#")]),t._v(" 匹配")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\n        location ^~ /backend {\n            alias   /data/www/backend;\n            index  index.html index.htm;\n        }\n        \n        //匹配以backend开头的路径\n        eg：\n        url: http://192.168.220.128/backend/d.js\n        会去 /data/www/backend/d.js 拿文件\n        \n        正则表达式\n        匹配以 .gif .jpg和.jpeg结尾的uri\n        location ~* \\.(gif|jpg|jpeg|png)$ {\n            root   /data/www/image;\n        }\n        \n        location ^~ /ui {\n            alias   /data/www;\n            try_files /ui/b.html $uri;\n        }\n        \n        //尝试\n        location ^~ /ui { \n            root   /data/www;\n            try_files /ui/a.html $uri/b.html $uri @other;\n        }\n        //匹配到了 先看/data/www/ui/a.html\n        在看 /data/www/输入的/b.html\n        再看 /data/www/输入的\n        否则：/data/www/index\n       location @other { //重定向 这里有问题 等待解决\n           root /data/www;\n           index index.html;\n        }\n\n\n        \n\n        \n \n")])])]),a("p",[t._v("注意：alias会将location后的url部分丢弃掉，而root不会")]),t._v(" "),a("p",[t._v("总结：匹配的优先顺序，"),a("code",[t._v("=")]),t._v(">"),a("code",[t._v("^~")]),t._v("（匹配固定字符串，忽略正则）>"),a("code",[t._v("~*")]),t._v(">"),a("code",[t._v("/")]),t._v(" ，工作中尽量将‘=’放在前面。")]),t._v(" "),a("h4",{attrs:{id:"配置vue工程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置vue工程"}},[t._v("#")]),t._v(" 配置vue工程：")]),t._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5CZhuChengHao%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221110102929330.png",alt:"image-20221110102929330"}})]),t._v(" "),a("p",[t._v("注意 资源文件问题")]),t._v(" "),a("h4",{attrs:{id:"对图片开启gzip压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对图片开启gzip压缩"}},[t._v("#")]),t._v(" 对图片开启gzip压缩")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("在http添加：\n\ngzip on;\ngzip_min_length 1k;\ngzip_buffers    4 16k;\ngzip_http_version 1.1;\ngzip_comp_level 5;\ngzip_types image/png;\ngzip_vary on;\n")])])]),a("h3",{attrs:{id:"_3-5反向代理解决跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5反向代理解决跨域"}},[t._v("#")]),t._v(" 3.5反向代理解决跨域")]),t._v(" "),a("p",[t._v("安装java环境")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("tar -zxvf jdk-8u351-linux-x64.tar.gz\nvim /etc/profile\n\nexport JAVA_HOME=/root/jdk1.8.0_351\nexport PATH=$PATH:$JAVA_HOME/bin\n\nsource /etc/profile\n")])])]),a("p",[t._v("运行：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("java -jar demo.jar\nps -ef | grep demo\nkill pid\n")])])]),a("p",[t._v("反向代理解决跨域:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location ^~ /api/ {\n    rewrite ^/api(.*)$ $1 break;\n    proxy_pass http://127.0.0.1:8080;\n}\n\n将/api这个前缀删除掉\n")])])]),a("h3",{attrs:{id:"_3-6为后端工程做负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6为后端工程做负载均衡"}},[t._v("#")]),t._v(" 3.6为后端工程做负载均衡")]),t._v(" "),a("p",[t._v("有时候，我们的后端工程压力太大，可能需要将后端工程部署在多台服务器上，此时就需要使用负载均衡了，在学习负载均衡的时候我们不妨先了解一下upstream模块。")]),t._v(" "),a("h4",{attrs:{id:"_1、upstream模块解读"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、upstream模块解读"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/nginx/#_1%E3%80%81upstream%E6%A8%A1%E5%9D%97%E8%A7%A3%E8%AF%BB",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1),t._v("1、upstream模块解读")]),t._v(" "),a("p",[t._v("nginx 的负载均衡功能依赖于 ngx_http_upstream_module模块。upstream 模块应该放于http{}标签内。")]),t._v(" "),a("p",[t._v("模块写法如下：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ip_hash")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" backend1.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" backend2.example.com:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 127.0.0.1:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" backup2.example.com:8080")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后在location处使用如下写法：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("以上写法的意思就是，将来同一个url访问我们的服务时，服务可以由backend中的服务器按照某种特定规则轮流提供。")]),t._v(" "),a("blockquote",[a("p",[t._v("ngixn负载均衡的五种算法")])]),t._v(" "),a("p",[t._v("（1）round robin 轮询 （默认） 按时间顺序依次将请求分配到各个后台服务器中，挂掉的服务器自动从列表中剔除")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" bakend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n   "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.1 down")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    \n   "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("（2）weight 轮询权重 weight的值越大分配到的访问概率越高，主要用于后端每台服务器性能不均衡的情况下，或在主从的情况下设置不同的权值，达到合理有效的地利用主机资源。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" bakend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.1 weight=20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.2 weight=10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("（3）ip_hash：每个请求按访问IP的哈希结果分配，使来自同一个IP的访客固定访问一台后端服务器，并且可以有效解决动态网页存在的session共享问题。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" bakend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ip_hash")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.1:88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.2:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),a("p",[t._v("（4）url_hash：按访问的URL的哈希结果来分配请求，使每个URL定向到同一台后端服务器，可以进一步提高后端服务器缓存的效率。Nginx本身不支持url_hash，需要安装Nginx的hash软件包。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.1:88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     //使用hash语句时，不能在使用weight等其他参数\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.2:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hash")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hash_method")]),t._v(" crc32")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    //使用hash算法\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("（5）fair算法：可以根据页面大小和加载时间长短智能地进行负载均衡，根据后端服务器的响应时间来分配请求，响应时间短的优先分配。Nginx本身不支持fair，要安装upstream_fair模块才能使用。")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.1:88")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.0.2:80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fair")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"_2、项目配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、项目配置"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://www.ydlclass.com/doc21xnv/nginx/#_2%E3%80%81%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("#"),a("OutboundLink")],1),t._v("2、项目配置")]),t._v(" "),a("p",[t._v("首先我们需要将我们的后端项目在服务器中启动两份或多份，可以是同一台服务器，也可以是多台服务器，只要可以互联互通即可。")]),t._v(" "),a("p",[t._v("同一台服务器可以使用如下命令，重新指定一个端口即可：")]),t._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("java -jar ydl-nginx.jar --server.port=8081\n")])])]),a("p",[t._v("我们需要定义一个upstream，将都有的后端服务配置在其中：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" ydlclass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 127.0.0.1:8080 weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 127.0.0.1:8081 weight "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("修改location的proxy_pass：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ^~ /api/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://ydlclass/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在浏览器中不停的刷新，发现端口在不停的变化，说明我们的多次请求确实落在了不同服务上。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20220713171258079.eee6d3ab.png",alt:"image-20220713171258079"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://www.ydlclass.com/doc21xnv/assets/image-20220713171229793.48f7dfb3.png",alt:"image-20220713171229793"}})]),t._v(" "),a("h3",{attrs:{id:"_3-7其他的跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7其他的跨域问题"}},[t._v("#")]),t._v(" 3.7其他的跨域问题")]),t._v(" "),a("p",[t._v("本机的前端项目")]),t._v(" "),a("p",[t._v("只需要在客户端发送【预检请求】时指定对应的响应头即可，nginx可以很方便的给响应增加一些首部信息，方法如下，在：")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ^~ /api/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow_Credentials'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Headers'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization,Accept,Origin,DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Content-Range,Range'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Methods'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET,POST,OPTIONS,PUT,DELETE,PATCH'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://ydlclass/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-8nginx监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8nginx监控"}},[t._v("#")]),t._v(" 3.8nginx监控")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[t._v("在server中\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设定查看Nginx状态的地址   ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n  "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("stub_status")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#表示开启stubStatus的工作状态统计功能。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp://192.168.220.128/status\n\n")])])]),a("h3",{attrs:{id:"_3-9其它nginx配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-9其它nginx配置"}},[t._v("#")]),t._v(" 3.9其它nginx配置")]),t._v(" "),a("h3",{attrs:{id:"_1-访问控制-allow-deny"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-访问控制-allow-deny"}},[t._v("#")]),t._v(" 1.访问控制 allow/deny")]),t._v(" "),a("p",[t._v("允许或禁止某个ip或ip段访问")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location /status {\n  stub_status on;\n  access_log off;\n  allow 192.168.10.100;\n  allow 172.29.73.0/24;\n  deny all;\n}\n")])])]),a("h3",{attrs:{id:"_2-列出目录-autoindex"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-列出目录-autoindex"}},[t._v("#")]),t._v(" 2.列出目录 autoindex")]),t._v(" "),a("p",[t._v("这个功能我们可以做一个资源下载站")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location ^~ /file {\n    root   /data/www;\n    autoindex on;\n    autoindex_exact_size off;\n    autoindex_localtime on;\n    charset utf-8,gbk;\n}\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);